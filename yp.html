<!doctype html><html><head><meta charset=UTF-8><title>有品电商技术演进 - By 张志勇</title><link rel=stylesheet href=//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=//cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link href=./md/img/css/chunk-vendors.676174ea.css rel=stylesheet></head><body><div><article id=webslides><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h1>有品电商技术演进</h1><h1>从单体 server 到分布式架构演进</h1><hr><h3>张志勇</h3></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>单体架构</h2></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/ceAqKmQ.png alt=""></p></div><div class=speaker-note><div class=wrap><p>甚至不能说是『架构』 接下来是面临的问题</p></div></div></section><section slide class=slide><div class=wrap wrap=true><h3>研发成本</h3><hr><ul><li>代码重复率高</li><li>需求变更困难</li><li>无法满足新业务快速迭代</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><h3>运维效率</h3><hr><ul><li>测试、部署成本高</li><li>可伸缩性差</li><li>可靠性差</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><h2>解决策略</h2><hr><ul><li>拆分</li><li>解耦</li><li>独立</li><li>分层</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>RPC</li><li>配置系统</li><li>服务注册</li><li>路由网关</li><li>日志系统</li><li>监控系统</li><li>压测平台</li></ul></div><div class=speaker-note><div class=wrap><p>这些是我们在过去一年对旧系统的改造</p></div></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>有品 dubbo - RPC</h2><hr></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>优化泛化调用</li><li>支持内部网关</li><li>支持外部网关</li><li>nacos 注册中心</li><li>支持业务错误码</li><li>统一结果输出格式</li><li>接入 zander</li><li>traceid</li><li>性能优化</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3 class=text-data>219</h3><p>219 个 provider 实例</p></div><div class=speaker-note><div class=wrap><p>219 个 provider 实例</p></div></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3 class=text-data>353</h3><p>353 个 consumer 实例</p></div><div class=speaker-note><div class=wrap><p>353 个 consumer 实例</p></div></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/avoBFvO.png alt=""></p></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>有品 nacos - 服务治理</h2><hr></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/7xVqPQM.png alt=""></p></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>服务注册 治理平台</li><li>高效访问 解耦</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/76pLCIm.png alt=""></p></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>业务网关(产品站)</h2><hr><ul><li>逻辑收敛、内容可裁剪、可并发</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>有品 gateway - 网关</h2><hr><ul><li>采用 API Gateway 可以与微服务注册中心连接，实现微服务无感知动态扩容</li><li>API Gateway 对于无法访问的服务，可以做到自动熔断，无需人工参与</li><li>API Gateway 可以方便的实现蓝绿部署，金丝雀发布或 A/B 发布</li><li>API Gateway 做为系统统一入口，我们可以将各个微服务公共功能放在 API Gateway 中实现，以尽可能减少各服务的职责</li><li>帮助我们实现客户端的负载均衡策略</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/nD6aa1a.png alt=""></p></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>流量控制</li><li>服务路由</li><li>数据缓存</li><li>协议转换</li><li>服务注册与发现</li><li>负载均衡</li><li>日志记录</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>监控系统 - owl</h2><hr><ul><li>实时分析:: 深入分析系统日志，通过Flink进行数据处理与计算</li><li>报警定制:: 建立了和有品办公IM的通信通道，报警信息能够直接发送到有品企业微信的相关负责人和群聊</li><li>上线预警:: 预置上线预警功能。当系统上线或上线代码更新时，当错误日志数量超过阈值时会开启报警，对上线行为进行提醒</li><li>运行分析:: 对系统运行状态进行计算分析，并通过运行图的方式进行展示</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>mibench - 压测平台</h2></div></section><section slide class=slide image=https://i.imgur.com/NAX2vSV.png><span class=background style="background-image:url('https://i.imgur.com/NAX2vSV.png')"></span><div class=wrap wrap=true></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>部署便捷</li><li>性能瓶颈</li><li>使压测可重放</li><li>具备一定的业务压测</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>智能 QPS 控制</li><li>压测性能好于任何一个被压测接口</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/dA36z9X.png alt=""></p></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>服务器无状态</li><li>生成报告、存档</li></ul></div></section><section slide class=slide><div class=wrap wrap=true><p><img src=https://i.imgur.com/NGJafQn.png alt=""></p></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>具备调试、权限管理</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/MZaEOOJ.png alt=""></p></div></section><section slide class=slide><div class=wrap wrap=true><ul><li>系统可支持水平扩展</li><li>Agent 服务治理</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/FiTYHXJ.png alt=""></p></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3 class=text-data>365</h3><p>服务 365 个接口</p></div><div class=speaker-note><div class=wrap><p>上线一年 365 个接口</p></div></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h3 class=text-data>3500</h3><p>产出 3500 份测试报告</p></div><div class=speaker-note><div class=wrap><p>上线一年 3500 份测试报告</p></div></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/FiUJUXi.png alt=加入mibench></p></div></section><section slide class=slide><div class=wrap wrap=true><h2>服务化架构</h2></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><p><img src=https://i.imgur.com/PApcS4t.png alt=架构图></p></div><div class=speaker-note><div class=wrap><p>经过上面的改造，这是现在的架构</p></div></div></section><section slide class="slide bg-black" :class="size-80 bg-black-blue" image="https://source.unsplash.com/6njoEbtarec/ .dark"><span class="background dark" style="background-image:url('https://source.unsplash.com/6njoEbtarec/')"></span><div class="wrap size-80 bg-black-blue" wrap=true><ul><li>使用怎样的技术需要根据团队的技术水平和技术发展的阶段进行取舍</li><li>没有完美的架构,只有<strong>合适</strong>的架构</li></ul></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>Thanks</h2></div></section><section slide class=slide :class=aligncenter><div class="wrap aligncenter" wrap=true><h2>Q&amp;A</h2></div></section></article></div><script>window.pluginsOptions = {}



document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const ws = new WebSlides({
        loop: false
    })
    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./md/img/js/chunk-vendors.js></script><script src=./md/img/js/yp.js></script></body></html>